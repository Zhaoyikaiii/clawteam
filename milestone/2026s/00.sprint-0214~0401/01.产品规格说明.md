# ClawTeam - 产品规格说明 (Product Specification)

> **文档版本**: v1.0
> **创建时间**: 2026-02-14
> **规格类型**: 功能性 + 非功能性需求

## 📋 目录

- [1. 高阶摘要](#1-高阶摘要)
- [2. 目标用户与用例](#2-目标用户与用例)
- [3. 功能需求](#3-功能需求)
- [4. 非功能需求](#4-非功能需求)
- [5. 成功指标](#5-成功指标)
- [6. 风险与缓解](#6-风险与缓解)

---

## 1. 高阶摘要

### 1.1 产品定位

面向团队、社区和家庭的即时通讯 + 协作平台，AI 代理以 **"第一等参与者"** 方式加入群聊，与人类并列，主动承担任务、保留上下文、跨会话联想与总结。

### 1.2 核心价值

| 价值维度 | 描述 |
|----------|------|
| **原生集成** | AI 不是外部工具，而是群组成员 |
| **上下文连续** | 跨聊天的全局记忆，解决上下文断裂 |
| **群组智能** | 人机协作释放集体生产力 |
| **隐私保护** | 联邦学习 + 端侧优先存储 |

### 1.3 竞品定位

不替代即时消息基础功能（如 WeChat、WhatsApp、Slack），而是 **"AI 伙伴层"** —— 把 AI 变成会话参与者并解决上下文断裂问题。

---

## 2. 目标用户与用例

### 2.1 目标用户群

```
┌─────────────────────────────────────────────────────────────┐
│                      目标用户金字塔                           │
├─────────────────────────────────────────────────────────────┤
│  第一波（早期采用者）                                          │
│  ├── AI 研究者/开发者                                        │
│  ├── 远程工作团队（跨时区协作需求强）                           │
│  └── 技术/投资社群（信息密度高）                               │
├─────────────────────────────────────────────────────────────┤
│  第二波（大众扩展）                                            │
│  ├── 知识工作者（需要知识管理）                                 │
│  ├── 学习社群（在线教育、读书会等）                             │
│  └── 家庭/朋友群（轻量协作需求）                                │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 关键用例（优先级排序）

#### P0 - 核心用例（MVP 必备）

| 用例 ID | 用例名称 | 触发方式 | 预期结果 |
|---------|----------|----------|----------|
| **UC-001** | 显式 @Agent 调用 | 用户发送 `@AgentName 指令` | Agent 以群组成员身份回复 |
| **UC-002** | 自动会议纪要 | 每 N 条消息或定时触发 | 生成结构化摘要 + 行动项 |
| **UC-003** | 全局搜索 | 用户搜索关键词 | 返回跨群相关内容 |
| **UC-004** | 任务创建 | Agent 从对话中提取 | 自动创建并分配任务 |

#### P1 - 扩展用例（V1 目标）

| 用例 ID | 用例名称 | 描述 |
|---------|----------|------|
| **UC-005** | 跨群上下文迁移 | 工程 PR 自动关联产品需求 |
| **UC-006** | 多模态理解 | 图片/视频内容分析与总结 |
| **UC-007** | 外部集成 | Gmail/GitHub/X 操作 |

#### P2 - 高级用例（V2+）

| 用例 ID | 用例名称 | 描述 |
|---------|----------|------|
| **UC-008** | 隐式意图触发 | 无需 @，系统自动识别并调用 Agent |
| **UC-009** | Agent 间协作 | 多 Agent 自动链式完成任务 |
| **UC-010** | 社区群组 | 公开群组与 Agent 市场 |

---

## 3. 功能需求

### 3.1 核心即时消息功能

| 功能 ID | 功能名称 | 描述 | 优先级 |
|---------|----------|------|--------|
| **MSG-001** | 群聊/私聊支持 | 文本、基础多模态消息 | P0 |
| **MSG-002** | @ 召唤 Agent | 类似 @ 用户的语法 | P0 |
| **MSG-003** | 消息引用/回复 | 支持线程化讨论 | P0 |
| **MSG-004** | 消息编辑/撤回 | 基础消息管理 | P1 |
| **MSG-005** | 多模态消息 | 图片/音频/视频/表情 | P1 |

### 3.2 代理框架 (Agent Framework)

#### 3.2.1 Agent 类型

```
┌─────────────────────────────────────────────────────────────┐
│                        Agent 分类                            │
├─────────────────────────────────────────────────────────────┤
│  系统级 Agent (System Agent)                                 │
│  ├── 内置：@SummaryAgent, @ResearchAgent                    │
│  ├── 平台级能力：全局记忆读写、跨群操作                       │
│  └── 不可删除，可配置权限                                     │
├─────────────────────────────────────────────────────────────┤
│  用户自建 Agent (Custom Agent)                               │
│  ├── 通过 GUI "+" 创建，无需编码                              │
│  ├── 配置：能力、提示词、外部集成                             │
│  └── 作用域：本群 / 指定群 / 全部群                           │
├─────────────────────────────────────────────────────────────┤
│  社区 Agent (Community Agent)                                │
│  ├── 公开分享的 Agent 模板                                   │
│  ├── 可发现、可订阅、可 Fork                                  │
│  └── V2 功能                                                 │
└─────────────────────────────────────────────────────────────┘
```

#### 3.2.2 Agent 能力声明

| 能力类别 | 能力示例 | 说明 |
|----------|----------|------|
| **理解类** | summarize, extract, analyze | 文本理解与处理 |
| **创作类** | write, generate, translate | 内容生成 |
| **工具类** | search, lookup | 信息检索 |
| **动作类** | send_email, create_pr, post_tweet | 外部系统操作（需授权） |

#### 3.2.3 Agent 生命周期

```
创建 → 配置 → 部署 → 运行 → 审计 → 下线
  │      │       │       │       │       │
  │      │       │       │       │       └─ 数据归档
  │      │       │       │       └── 操作日志
  │      │       │       └─ 性能监控
  │      │       └─ 权限绑定
  │      └─ 提示词/能力设置
  └─ GUI 向导或模板选择
```

### 3.3 全局记忆层 (Global Memory)

#### 3.3.1 记忆类型

| 类型 | 存储内容 | 检索方式 | 保留策略 |
|------|----------|----------|----------|
| **消息索引** | 原始消息 embedding | 向量检索 | 永久 |
| **摘要记忆** | 会话摘要、决策记录 | 关键词 + 向量 | 可配置 |
| **行动项** | 任务、待办 | 状态 + 关联 | 完成后归档 |
| **知识条目** | 提炼的知识点 | 标签 + 全文 | 永久 |

#### 3.3.2 记忆操作

| 操作 | API | 权限要求 |
|------|-----|----------|
| **写入** | `POST /memory/entries` | Agent 需授权 |
| **读取** | `GET /memory/search` | 群成员可读 |
| **订阅** | `POST /memory/watch` | 用户订阅关键词 |
| **导出** | `GET /memory/export` | 管理员 |

### 3.4 隐私与访问控制

#### 3.4.1 权限模型

```
┌─────────────────────────────────────────────────────────────┐
│                         PDP 架构                             │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│    请求 ──► 主体认证 ──► 策略评估 ──► 决策 ◄─► 审计            │
│               │           │           │           │           │
│               │           │           │           │           │
│               ▼           ▼           ▼           ▼           ▼
│            User      Resource    Condition   Action    Effect  │
│                      Type       Scope                 Log     │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

| 权限维度 | 说明 | 示例 |
|----------|------|------|
| **消息级** | 谁可读特定消息 | 私聊消息加密 |
| **群级** | 谁可加入/操作 | 群管理员权限 |
| **Agent 访问级** | Agent 可读写哪些数据 | Agent 作用域配置 |

#### 3.4.2 默认策略

| 操作 | 默认策略 | 可覆盖 |
|------|----------|--------|
| Agent 读消息 | ✅ 允许（群内） | ❌ |
| Agent 写记忆 | ❌ 需管理员开启 | ✅ |
| Agent 外部操作 | ❌ 需用户确认 | ✅ |
| Agent 建任务 | ✅ 允许 | ✅ |

### 3.5 第三方集成

| 集成类型 | 认证方式 | 示例服务 |
|----------|----------|----------|
| **OAuth2** | 标准授权码流 | Gmail, X, GitHub |
| **API Key** | 用户配置 | OpenAI, Anthropic |
| **Webhook** | 事件订阅 | 自定义服务 |

### 3.6 管理与审计

#### 3.6.1 审计日志字段

| 字段 | 类型 | 说明 |
|------|------|------|
| `actor_id` | string | 操作者（用户或 Agent） |
| `action` | string | 操作类型 |
| `target_id` | string | 目标资源 |
| `payload_hash` | string | 操作内容哈希 |
| `timestamp` | datetime | 操作时间 |
| `provenance` | array | 来源消息 IDs |

#### 3.6.2 对话快照

- 支持将会话状态保存为快照
- 可恢复至历史快照
- 支持快照比对与差异分析

---

## 4. 非功能需求

### 4.1 性能指标

| 指标 | 目标 | 测量方式 |
|------|------|----------|
| **全局记忆检索延迟** | < 300ms (P95) | 搜索查询响应时间 |
| **Agent 响应延迟** | < 2s (轻量请求) | 从消息到 Agent 回复 |
| **消息延迟** | ≤2s (端到端) | 消息发送到送达 |
| **并发用户** | 10万+ | 在线用户数 |

### 4.2 可用性

| 指标 | 目标 |
|------|------|
| **SLA** | 99.9% |
| **故障恢复** | < 5min MTTR |
| **数据持久性** | 99.999% |

### 4.3 安全性

| 需求 | 说明 |
|------|------|
| **传输加密** | TLS 1.3 |
| **存储加密** | 敏感数据加密存储 |
| **E2EE** | 可选端到端加密 |
| **密钥管理** | 标准密钥生命周期管理 |
| **合规** | GDPR / 本地数据法规 |

### 4.4 隐私

| 需求 | 说明 |
|------|------|
| **默认隐私最小化** | 只收集必要数据 |
| **数据分区** | 敏感数据默认端侧 |
| **保留策略** | 用户可配置（X 天/手动/永久） |
| **被遗忘权** | 支持数据删除 |

### 4.5 成本控制

| 策略 | 说明 |
|------|------|
| **分层模型** | 本地轻量模型优先，云端大模型按需 |
| **Token 优化** | 上下文压缩、缓存 |
| **弹性扩缩容** | 按负载动态调整 |

---

## 5. 成功指标 (KPIs)

### 5.1 技术指标

| 指标 | 目标 |
|------|------|
| 全局记忆检索延迟 | < 300ms |
| Agent 响应时延 | < 2s |
| 系统可用性 | 99.9% |
| API 错误率 | < 0.1% |

### 5.2 产品指标

| 指标 | 目标 |
|------|------|
| 30 日留存率 | ≥ 25%（核心用户） |
| Agent 触发率 | ≥ 50% 的活跃会话 |
| 行动项完成率 | ≥ 60% |
| 跨群检索使用率 | ≥ 30% DAU |

### 5.3 安全指标

| 指标 | 目标 |
|------|------|
| 合规审计 | 100% 通过 |
| 数据泄露事件 | 0 |

---

## 6. 风险与缓解

| 风险类别 | 风险描述 | 缓解措施 |
|----------|----------|----------|
| **隐私/监管** | 数据合规风险 | 端侧优先、差分隐私、安全聚合 |
| **上下文污染** | 错误记忆影响决策 | 记忆置信度、人工标注、校正机制 |
| **成本失控** | 大模型推理成本过高 | 多层次推理策略、本地模型优先 |
| **滥用** | 自动发帖/诈骗 | 频率限制、强制授权、人工审批 |
| **Agent 冲突** | 多 Agent 决策冲突 | 仲裁策略、优先级规则 |

---

## 7. 附件

### 7.1 用例详细描述

#### UC-001: 显式 @Agent 调用

**前置条件**: 用户在群组中，Agent 已加入群组

**主流程**:
1. 用户输入 `@SummaryAgent 帮我总结今天的讨论`
2. 客户端发送消息到服务器
3. Social Brain 识别 @ 引用
4. 检查 Agent 权限
5. Agent Runtime 执行任务
6. Agent 回复总结结果
7. 结果展示在群聊中

**后置条件**: 总结结果被记录到全局记忆

#### UC-003: 全局搜索

**前置条件**: 用户在多个群组中有历史消息

**主流程**:
1. 用户在搜索框输入关键词
2. 系统在全局记忆中检索
3. 返回跨群相关内容，按相关性排序
4. 用户点击结果跳转到原消息

### 7.2 状态码定义

| 代码 | 含义 |
|------|------|
| 200 | 成功 |
| 400 | 请求错误 |
| 401 | 未认证 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 429 | 请求过于频繁 |
| 500 | 服务器错误 |
| 503 | 服务不可用 |

---

## 🏷️ 标签

`#产品规格` `#功能需求` `#非功能需求` `#用例` `#KPI` `#风险管理`

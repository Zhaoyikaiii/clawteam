# ClawTeam - Agent è°ƒåº¦ç®—æ³•

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **åˆ›å»ºæ—¶é—´**: 2026-02-14
> **æ ¸å¿ƒç›®æ ‡**: åœ¨æ­£ç¡®çš„æ—¶é—´è°ƒç”¨æ­£ç¡®çš„ Agent

## ğŸ“‹ ç›®å½•

- [1. è°ƒåº¦é—®é¢˜å®šä¹‰](#1-è°ƒåº¦é—®é¢˜å®šä¹‰)
- [2. è°ƒåº¦æµç¨‹](#2-è°ƒåº¦æµç¨‹)
- [3. å¬å›ç®—æ³•](#3-å¬å›ç®—æ³•)
- [4. æ’åºç®—æ³•](#4-æ’åºç®—æ³•)
- [5. åˆå¹¶ç­–ç•¥](#5-åˆå¹¶ç­–ç•¥)
- [6. æˆæœ¬æ§åˆ¶](#6-æˆæœ¬æ§åˆ¶)

---

## 1. è°ƒåº¦é—®é¢˜å®šä¹‰

### 1.1 æ ¸å¿ƒé—®é¢˜

Agent è°ƒåº¦éœ€è¦è§£å†³ 5 ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š

```mermaid
flowchart LR
    subgraph Problems["è°ƒåº¦è¦è§£å†³çš„ 5 ä¸ªé—®é¢˜"]
        A[1. ä»€ä¹ˆæ—¶å€™è§¦å‘?]
        B[2. è°ƒç”¨å“ªä¸ª Agent?]
        C[3. å¹¶å‘å¤šå°‘?]
        D[4. æƒé™å¤Ÿå—?]
        E[5. ç»“æœæ€ä¹ˆåˆ?]
    end

    A --> Trigger[è§¦å‘åˆ¤å®š]
    B --> Recall[å¬å›é€‰æ‹©]
    C --> Resource[èµ„æºæ§åˆ¶]
    D --> Policy[æƒé™æ£€æŸ¥]
    E --> Merge[ç»“æœåˆå¹¶]
```

### 1.2 è°ƒåº¦ç›®æ ‡

| ç›®æ ‡ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|--------|------|
| **å‡†ç¡®æ€§** | P0 | é€‰æ‹©æœ€åˆé€‚çš„ Agent |
| **å“åº”é€Ÿåº¦** | P0 | å°½å¿«è¿”å›ç»“æœ |
| **æˆæœ¬æ§åˆ¶** | P1 | æœ€å°åŒ– token æ¶ˆè€— |
| **ç”¨æˆ·ä½“éªŒ** | P1 | å‡å°‘ç­‰å¾…å’Œæ‰“æ‰° |
| **ç³»ç»Ÿç¨³å®šæ€§** | P2 | é˜²æ­¢è¿‡è½½ |

---

## 2. è°ƒåº¦æµç¨‹

### 2.1 å®Œæ•´æµç¨‹

```mermaid
flowchart TD
    Start([æ”¶åˆ°æ¶ˆæ¯]) --> onMessage[onMessage]

    onMessage --> Step1[Step 1: æ„å»ºä¸Šä¸‹æ–‡]
    Step1 --> Step2[Step 2: æ„å›¾è¯†åˆ«]
    Step2 --> Step3[Step 3: è§¦å‘åˆ¤å®š]

    Step3 --> Explicit{æ˜¾å¼ @?}
    Explicit -->|æ˜¯| AddExplicit[æ·»åŠ  @ çš„ Agent]
    Explicit -->|å¦| Implicit{éšå¼æ„å›¾?}

    Implicit -->|ç½®ä¿¡åº¦å¤Ÿ| AddImplicit[æ·»åŠ æ¨è Agent]
    Implicit -->|å¦| NoAgent[æ—  Agent]

    AddExplicit --> Step4[Step 4: å¬å›å€™é€‰]
    AddImplicit --> Step4

    Step4 --> Step5[Step 5: æ’åºæ‰“åˆ†]
    Step5 --> Step6[Step 6: æƒé™æ£€æŸ¥]

    Step6 --> Policy{æƒé™å†³ç­–}
    Policy -->|Deny| LogDeny[è®°å½•æ‹’ç»]
    Policy -->|Require Approval| CreateApproval[åˆ›å»ºå®¡æ‰¹]
    Policy -->|Allow| Step7[Step 7: è°ƒåº¦æ‰§è¡Œ]

    CreateApproval --> WaitUser[ç­‰å¾…ç”¨æˆ·]
    WaitUser --> UserDec{ç”¨æˆ·å†³ç­–}
    UserDec -->|æ‰¹å‡†| Step7
    UserDec -->|æ‹’ç»| LogDeny

    Step7 --> RunJobs[è¿è¡Œ Jobs]
    RunJobs --> Step8[Step 8: ç»“æœåˆå¹¶]

    Step8 --> Step9[Step 9: å›å†™è®°å¿†]
    Step9 --> Step10[Step 10: å‘é€å›å¤]
    Step10 --> End([å®Œæˆ])

    NoAgent --> End
    LogDeny --> End
```

### 2.2 ä¼ªä»£ç å®ç°

```python
async def orchestrate(event: MessageEvent) -> OrchestrationResult:
    """
    ä¸»ç¼–æ’å‡½æ•°
    """
    # ===== Step 1: æ„å»ºä¸Šä¸‹æ–‡ =====
    ctx = await build_context(
        chat_id=event.chat_id,
        recent_messages=100,  # æœ€è¿‘ 100 æ¡æ¶ˆæ¯
        include_thread=True,
        include_participants=True
    )

    # ===== Step 2: æ„å›¾è¯†åˆ« =====
    intent = await intent_classifier.classify(event, ctx)

    # ===== Step 3: è§¦å‘åˆ¤å®š =====
    triggers = []

    # æ˜¾å¼è§¦å‘
    if event.has_explicit_mentions:
        triggers.extend([
            Trigger(type='explicit_mention', source=agent_id)
            for agent_id in event.mentioned_agents
        ])

    # éšå¼è§¦å‘
    if intent.confidence > 0.7 and intent.needs_agent:
        triggers.extend([
            Trigger(type='implicit_intent', source=agent_id)
            for agent_id in await recommend_agents(intent, ctx)
        ])

    if not triggers:
        return OrchestrationResult(type='no_action')

    # ===== Step 4: å¬å›å€™é€‰ Agent =====
    candidates = await agent_recall.recall(
        triggers=triggers,
        intent=intent,
        context=ctx
    )

    # ===== Step 5: æ’åºæ‰“åˆ† =====
    scored = await agent_ranker.rank(
        candidates=candidates,
        intent=intent,
        context=ctx
    )

    # ===== Step 6: æƒé™æ£€æŸ¥ =====
    executable = []
    approval_required = []

    for item in scored:
        decision = await pdp.evaluate(
            agent_id=item.agent_id,
            user_id=event.sender_id,
            intent=intent,
            context=ctx
        )

        if decision.effect == 'allow':
            executable.append(item)
        elif decision.effect == 'require_approval':
            approval_required.append(item)

    # å¤„ç†éœ€è¦å®¡æ‰¹çš„
    if approval_required:
        approval_result = await request_user_approval(
            approval_required,
            intent=intent
        )
        if approval_result.approved:
            executable.extend(approval_result.approved_items)

    if not executable:
        return OrchestrationResult(type='denied')

    # ===== Step 7: è°ƒåº¦æ‰§è¡Œ =====
    plans = [
        make_agent_job(
            agent=item.agent_id,
            intent=intent,
            context=ctx,
            memory_read_scopes=item.memory_scopes
        )
        for item in executable
    ]

    results = await run_jobs(
        plans,
        concurrency=len(executable),  # å¹¶å‘æ‰§è¡Œ
        timeout=30  # 30 ç§’è¶…æ—¶
    )

    # ===== Step 8: ç»“æœåˆå¹¶ =====
    merged = await merge_results(
        results=results,
        strategy=select_merge_strategy(intent)
    )

    # ===== Step 9: å›å†™è®°å¿† =====
    await memory_write(
        summaries=merged.summaries,
        action_items=merged.action_items,
        decisions=merged.decisions,
        provenance=results
    )

    # ===== Step 10: å®¡è®¡ =====
    await audit_log(
        event=event,
        intent=intent,
        plans=plans,
        results=results
    )

    # ===== Step 11: å‘é€å›å¤ =====
    return await post_to_chat(
        response=merged.response,
        citations=merged.citations
    )
```

---

## 3. å¬å›ç®—æ³•

### 3.1 å¬å›ç­–ç•¥

```mermaid
flowchart TD
    subgraph Recall["å¬å›ç­–ç•¥"]
        A[èƒ½åŠ›åŒ¹é…å¬å›]
        B[æ˜¾å¼å¬å›]
        C[ç¾¤é…ç½®å¬å›]
        D[å†å²åå¥½å¬å›]
        E[ç›¸ä¼¼åœºæ™¯å¬å›]
    end

    Intent[æ„å›¾: summarize] --> A
    Mention[@SummaryAgent] --> B
    ChatConfig[ç¾¤é»˜è®¤ Agent] --> C
    History[è¿‡å»7å¤©æœ€å¸¸ç”¨] --> D
    Similar[ç›¸ä¼¼åœºæ™¯æˆåŠŸè¿‡] --> E

    A --> Union[Union å»é‡]
    B --> Union
    C --> Union
    D --> Union
    E --> Union

    Union --> Candidates[å€™é€‰ Agent åˆ—è¡¨]
```

### 3.2 èƒ½åŠ›ç´¢å¼•

```python
class CapabilityIndex:
    """
    Agent èƒ½åŠ›ç´¢å¼•ï¼Œæ”¯æŒå¿«é€ŸæŸ¥æ‰¾
    """

    def __init__(self):
        # èƒ½åŠ› -> Agent IDs åå‘ç´¢å¼•
        self.capability_index: Dict[str, Set[str]] = defaultdict(set)

        # Agent -> èƒ½åŠ›å£°æ˜
        self.agent_capabilities: Dict[str, List[Capability]] = {}

    def register(self, agent_id: str, capabilities: List[Capability]):
        """æ³¨å†Œ Agent èƒ½åŠ›"""
        self.agent_capabilities[agent_id] = capabilities

        for cap in capabilities:
            # æŒ‰èƒ½åŠ›ç±»å‹ç´¢å¼•
            self.capability_index[cap.type].add(agent_id)

            # æŒ‰å…·ä½“èƒ½åŠ›ç´¢å¼•
            if cap.name:
                self.capability_index[f"{cap.type}:{cap.name}"].add(agent_id)

    def lookup(self, intent: Intent) -> Set[str]:
        """æ ¹æ®æ„å›¾æŸ¥æ‰¾å€™é€‰ Agent"""
        candidates = set()

        # æ„å›¾ç±»å‹æ˜ å°„åˆ°èƒ½åŠ›ç±»å‹
        intent_to_capability = {
            'qa': 'qa',
            'summarize': 'summarize',
            'search': 'search',
            'create': 'create',
            'action': 'action',
        }

        cap_type = intent_to_capability.get(intent.category)
        if cap_type:
            candidates.update(self.capability_index.get(cap_type, set()))

        # è€ƒè™‘å­ç±»åˆ«
        if intent.subcategory:
            candidates.update(
                self.capability_index.get(f"{cap_type}:{intent.subcategory}", set())
            )

        return candidates
```

### 3.3 å¬å›é…ç½®

| å¬å›ç­–ç•¥ | é…ç½®å‚æ•° | é»˜è®¤å€¼ |
|----------|----------|--------|
| **èƒ½åŠ›åŒ¹é…** | å¯ç”¨/ç¦ç”¨ | âœ… å¯ç”¨ |
| **æ˜¾å¼å¬å›** | å¯ç”¨/ç¦ç”¨ | âœ… å¯ç”¨ |
| **ç¾¤é…ç½®** | å¯ç”¨/ç¦ç”¨ | âœ… å¯ç”¨ |
| **å†å²åå¥½** | æ—¶é—´çª—å£ | 7 å¤© |
| **ç›¸ä¼¼åœºæ™¯** | ç›¸ä¼¼åº¦é˜ˆå€¼ | 0.8 |
| **æœ€å¤§å¬å›æ•°** | N | 10 |

---

## 4. æ’åºç®—æ³•

### 4.1 æ‰“åˆ†å…¬å¼

```python
def score_agent(
    agent: Agent,
    intent: Intent,
    context: ExecutionContext
) -> ScoredAgent:
    """
    å¯¹ Agent è¿›è¡Œæ‰“åˆ†æ’åº

    Score = Î£(weight_i Ã— factor_i)
    """

    # èƒ½åŠ›åŒ¹é…åº¦ (0-1)
    capability_score = calculate_capability_match(agent, intent)

    # èŠå¤©ç›¸å…³åº¦ (0-1)
    relevance_score = calculate_chat_relevance(agent, context)

    # å†å²æˆåŠŸç‡ (0-1)
    success_score = calculate_historical_success(agent, intent)

    # ä¼°ç®—æˆæœ¬ (0-1, æƒ©ç½šé¡¹)
    cost_score = calculate_cost_penalty(agent, intent)

    # é£é™©è¯„åˆ† (0-1, æƒ©ç½šé¡¹)
    risk_score = calculate_risk_level(agent, intent)

    # åŠ æƒæ±‚å’Œ
    final_score = (
        0.40 * capability_score +
        0.20 * relevance_score +
        0.20 * success_score -
        0.10 * cost_score -
        0.10 * risk_score
    )

    return ScoredAgent(
        agent_id=agent.id,
        score=final_score,
        reasons=[
            f"èƒ½åŠ›åŒ¹é…: {capability_score:.2f}",
            f"èŠå¤©ç›¸å…³: {relevance_score:.2f}",
            f"å†å²æˆåŠŸ: {success_score:.2f}",
            f"æˆæœ¬æƒ©ç½š: {cost_score:.2f}",
            f"é£é™©è¯„åˆ†: {risk_score:.2f}",
        ]
    )
```

### 4.2 å„å› å­è¯¦è§£

#### 4.2.1 èƒ½åŠ›åŒ¹é…åº¦

```python
def calculate_capability_match(agent: Agent, intent: Intent) -> float:
    """
    è®¡ç®—èƒ½åŠ›åŒ¹é…åº¦
    """
    # è·å– Agent çš„èƒ½åŠ›
    agent_caps = {cap.type for cap in agent.capabilities}

    # æ„å›¾éœ€è¦çš„èƒ½åŠ›
    required_caps = get_required_capabilities(intent)

    if not required_caps:
        return 0.5  # ä¸­æ€§

    # Jaccard ç›¸ä¼¼åº¦
    intersection = len(agent_caps & required_caps)
    union = len(agent_caps | required_caps)

    return intersection / union if union > 0 else 0
```

#### 4.2.2 èŠå¤©ç›¸å…³åº¦

```python
def calculate_chat_relevance(agent: Agent, context: ExecutionContext) -> float:
    """
    è®¡ç®— Agent ä¸å½“å‰èŠå¤©çš„ç›¸å…³åº¦
    """
    score = 0.0

    # 1. Agent æ˜¯å¦åœ¨ç¾¤é…ç½®ä¸­
    if agent.id in context.chat_config.enabled_agents:
        score += 0.3

    # 2. Agent è¿‡å»åœ¨ç¾¤çš„æ´»è·ƒåº¦
    agent_activity = get_agent_activity_in_chat(
        agent.id,
        context.chat_id,
        window=timedelta(days=7)
    )
    score += min(agent_activity / 10, 0.3)  # æœ€å¤š 0.3

    # 3. Agent æ˜¯å¦ä¸è¯é¢˜ç›¸å…³
    topic_match = calculate_topic_match(agent, context)
    score += topic_match * 0.4

    return score
```

#### 4.2.3 å†å²æˆåŠŸç‡

```python
def calculate_historical_success(agent: Agent, intent: Intent) -> float:
    """
    è®¡ç®—å†å²æˆåŠŸç‡
    """
    # è·å–å†å²æ‰§è¡Œè®°å½•
    history = get_agent_execution_history(
        agent_id=agent.id,
        intent_category=intent.category,
        limit=100
    )

    if not history:
        return 0.5  # æ— å†å²æ•°æ®ï¼Œä¸­æ€§

    # è®¡ç®—æˆåŠŸç‡
    successful = sum(1 for h in history if h.success)
    success_rate = successful / len(history)

    # è€ƒè™‘ç”¨æˆ·æ»¡æ„åº¦
    avg_satisfaction = sum(h.satisfaction for h in history) / len(history)

    return (success_rate * 0.7 + avg_satisfaction * 0.3)
```

#### 4.2.4 æˆæœ¬æƒ©ç½š

```python
def calculate_cost_penalty(agent: Agent, intent: Intent) -> float:
    """
    è®¡ç®—æˆæœ¬æƒ©ç½šï¼ˆè¶Šé«˜è¶Šå¥½ï¼Œä½†åœ¨å…¬å¼ä¸­æ˜¯å‡é¡¹ï¼‰
    """
    # ä¼°ç®— token æ¶ˆè€—
    estimated_tokens = estimate_token_usage(agent, intent)

    # æ ¹æ®é¢„ç®—è®¾å®šæƒ©ç½š
    if estimated_tokens < 1000:
        return 0.0  # ä½æˆæœ¬ï¼Œæ— æƒ©ç½š
    elif estimated_tokens < 5000:
        return 0.3  # ä¸­ç­‰æˆæœ¬
    else:
        return 0.7  # é«˜æˆæœ¬ï¼Œé«˜æƒ©ç½š
```

#### 4.2.5 é£é™©è¯„åˆ†

```python
def calculate_risk_level(agent: Agent, intent: Intent) -> float:
    """
    è®¡ç®—é£é™©è¯„åˆ†ï¼ˆè¶Šé«˜é£é™©è¶Šå¤§ï¼Œä½†åœ¨å…¬å¼ä¸­æ˜¯å‡é¡¹ï¼‰
    """
    risk = 0.0

    # 1. æ˜¯å¦éœ€è¦å¤–éƒ¨æ“ä½œ
    if intent.category == 'action':
        risk += 0.3

    # 2. Agent æƒé™èŒƒå›´
    if agent.has_external_write_access:
        risk += 0.3

    # 3. ç”¨æˆ·ä¿¡ä»»åº¦
    trust = get_user_trust_score(agent.id)
    risk += (1.0 - trust) * 0.4

    return risk
```

---

## 5. åˆå¹¶ç­–ç•¥

### 5.1 ç­–ç•¥é€‰æ‹©çŸ©é˜µ

| ç­–ç•¥ | é€‚ç”¨åœºæ™¯ | ç®—æ³•æè¿° | è¾“å‡ºç¤ºä¾‹ |
|------|----------|----------|----------|
| **best_of** | æ€»ç»“ç±»ã€QA ç±» | é€‰æœ€å…¨é¢ä¸”æœ€å°‘å¹»è§‰çš„ç»“æœ | å•ä¸ªæœ€ä½³å›ç­” |
| **consensus** | è¡ŒåŠ¨ç±» | å¤šæ•°ä¸€è‡´æ‰æ‰§è¡Œï¼Œå¦åˆ™ç¡®è®¤ | å…±è¯†è¡ŒåŠ¨æˆ–ç¡®è®¤è¯·æ±‚ |
| **primary_reviewer** | ä»£ç ç±» | ä¸» Agent ç”Ÿæˆï¼Œå®¡æ ¸ Agent æ£€æŸ¥ | ä»£ç  + å®¡æŸ¥æ„è§ |
| **all** | åˆ›æ„ç±»ã€é€‰æ‹©ç±» | å…¨éƒ¨å±•ç¤ºï¼Œè®©ç”¨æˆ·é€‰æ‹© | å¤šä¸ªé€‰é¡¹ä¾›é€‰æ‹© |

### 5.2 Best-Of ç®—æ³•

```python
async def merge_best_of(results: List[TaskResult]) -> MergedResult:
    """
    é€‰æ‹©æœ€å¥½çš„ç»“æœ

    è¯„ä¼°ç»´åº¦:
    1. å®Œæ•´æ€§ - æ˜¯å¦å›ç­”äº†æ‰€æœ‰é—®é¢˜
    2. å¹»è§‰åº¦ - æ˜¯å¦æœ‰äº‹å®é”™è¯¯
    3. å¼•ç”¨è´¨é‡ - å¼•ç”¨æ˜¯å¦ç›¸å…³
    """
    scored = []

    for result in results:
        # å®Œæ•´æ€§è¯„åˆ†
        completeness = score_completeness(result)

        # å¹»è§‰åº¦è¯„åˆ† (åå‘ï¼Œè¶Šä½è¶Šå¥½)
        hallucination = score_hallucination(result)

        # å¼•ç”¨è´¨é‡
        citation_quality = score_citations(result)

        # ç»¼åˆè¯„åˆ†
        score = (
            0.5 * completeness +
            0.3 * (1.0 - hallucination) +
            0.2 * citation_quality
        )

        scored.append((result, score))

    # é€‰æœ€é«˜åˆ†çš„
    best = max(scored, key=lambda x: x[1])

    return MergedResult(
        response=best[0].response,
        citations=best[0].citations,
        confidence=best[1],
        provenance={best[0].agent_id: 'selected_as_best'}
    )
```

### 5.3 Consensus ç®—æ³•

```python
async def merge_consensus(results: List[TaskResult]) -> MergedResult:
    """
    å…±è¯†åˆå¹¶

    å¯¹äºè¡ŒåŠ¨ç±»ä»»åŠ¡ï¼Œéœ€è¦å¤šä¸ª Agent è¾¾æˆå…±è¯†
    """
    # æå–æ‰€æœ‰å»ºè®®çš„è¡ŒåŠ¨
    all_actions = []
    for result in results:
        all_actions.extend(result.action_items)

    if not all_actions:
        return MergedResult(response="æ— éœ€æ‰§è¡Œä»»ä½•è¡ŒåŠ¨")

    # æŒ‰è¡ŒåŠ¨ç±»å‹åˆ†ç»„
    grouped = group_actions(all_actions)

    consensus_actions = []
    need_confirmation = []

    for action_type, actions in grouped.items():
        # å¦‚æœæ‰€æœ‰ Agent éƒ½å»ºè®®è¿™ä¸ªè¡ŒåŠ¨
        if len(actions) == len(results):
            consensus_actions.append(actions[0])
        else:
            # éƒ¨åˆ†å»ºè®®ï¼Œéœ€è¦ç¡®è®¤
            need_confirmation.append({
                'type': action_type,
                'suggested_by': [a.agent_id for a in actions],
                'description': actions[0].description
            })

    response_parts = []
    if consensus_actions:
        response_parts.append(f"å·²æ‰§è¡Œ {len(consensus_actions)} ä¸ªè¡ŒåŠ¨")
    if need_confirmation:
        response_parts.append("ä»¥ä¸‹è¡ŒåŠ¨éœ€è¦ç¡®è®¤:\n" + "\n".join([
            f"- {item['description']} (å»ºè®®: {', '.join(item['suggested_by'])})"
            for item in need_confirmation
        ]))

    return MergedResult(
        response="\n".join(response_parts),
        action_items=consensus_actions,
        confirmation_required=need_confirmation
    )
```

---

## 6. æˆæœ¬æ§åˆ¶

### 6.1 åˆ†å±‚æ¨ç†ç­–ç•¥

```mermaid
flowchart TD
    Input[ç”¨æˆ·è¯·æ±‚] --> Complexity{å¤æ‚åº¦?}

    Complexity -->|ç®€å•| Local[æœ¬åœ°æ¨¡å‹<br/>è½»é‡å¿«é€Ÿ]
    Complexity -->|ä¸­ç­‰| CloudSmall[äº‘ç«¯å°æ¨¡å‹<br/>å¹³è¡¡]
    Complexity -->|å¤æ‚| CloudLarge[äº‘ç«¯å¤§æ¨¡å‹<br/>é«˜è´¨é‡]

    Local --> Output[è¿”å›ç»“æœ]
    CloudSmall --> Output
    CloudLarge --> Output

    CloudSmall -.-> Cache[ç¼“å­˜ç»“æœ]
    CloudLarge -.-> Cache
```

### 6.2 æˆæœ¬æ§åˆ¶é…ç½®

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| **å†·å¯åŠ¨æ¨¡å¼** | é»˜è®¤å• Agent | âœ… å¯ç”¨ |
| **æœ€å¤§å¹¶å‘** | åŒæ—¶è¿è¡Œçš„ Agent æ•° | 3 |
| **Token é¢„ç®—** | å•æ¬¡æœ€å¤§ token | 10000 |
| **ç¼“å­˜ç­–ç•¥** | å¯ç”¨ç»“æœç¼“å­˜ | âœ… å¯ç”¨ |
| **é™çº§ç­–ç•¥** | è¿‡è½½æ—¶é™çº§æœåŠ¡ | âœ… å¯ç”¨ |

### 6.3 æˆæœ¬ä¼°ç®—

```python
def estimate_job_cost(job: AgentJob) -> CostEstimate:
    """
    ä¼°ç®— Agent Job æˆæœ¬
    """
    # è¾“å…¥ token
    input_tokens = estimate_input_tokens(job)

    # æ ¹æ®å†å²æ•°æ®ä¼°ç®—è¾“å‡º token
    output_tokens = estimate_output_tokens(
        agent_id=job.agent_id,
        intent=job.instruction
    )

    # æ¨¡å‹å®šä»·
    pricing = get_model_pricing(job.model)

    # è®¡ç®—
    input_cost = (input_tokens / 1000) * pricing.input_per_1k
    output_cost = (output_tokens / 1000) * pricing.output_per_1k

    return CostEstimate(
        input_tokens=input_tokens,
        output_tokens=output_tokens,
        total_cost=input_cost + output_cost,
        currency='USD'
    )
```

---

## 7. è°ƒåº¦ç¤ºä¾‹

### 7.1 ç¤ºä¾‹ 1: ç®€å• @ è°ƒç”¨

```
ç”¨æˆ·æ¶ˆæ¯: "@SummaryAgent å¸®æˆ‘æ€»ç»“ä»Šå¤©çš„è®¨è®º"

æµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è§¦å‘: æ˜¾å¼ @SummaryAgent                                    â”‚
â”‚ 2. æ„å›¾: summarize (ç½®ä¿¡åº¦: 0.98)                              â”‚
â”‚ 3. å¬å›: [SummaryAgent]                                       â”‚
â”‚ 4. æ‰“åˆ†: SummaryAgent (0.95)                                  â”‚
â”‚ 5. æƒé™: Allow (è¯»ç¾¤æ¶ˆæ¯, å†™è®°å¿†éœ€ç¡®è®¤)                        â”‚
â”‚ 6. æ‰§è¡Œ: è°ƒç”¨ SummaryAgent                                    â”‚
â”‚ 7. åˆå¹¶: single result                                        â”‚
â”‚ 8. ç»“æœ: æ€»ç»“ + è¡ŒåŠ¨é¡¹åˆ—è¡¨                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ç¤ºä¾‹ 2: éšå¼å¤š Agent

```
ç”¨æˆ·æ¶ˆæ¯: "æˆ‘ä»¬éœ€è¦ä¸ºä¸‹å‘¨çš„è·¯æ¼”å‡†å¤‡ææ–™ï¼ŒåŒ…æ‹¬å¹»ç¯ç‰‡å’Œæ¼”ç¤ºè„šæœ¬"

æµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è§¦å‘: éšå¼æ„å›¾æ£€æµ‹ (action + create, ç½®ä¿¡åº¦: 0.85)          â”‚
â”‚ 2. å¬å›: [SlideAgent, ScriptAgent, PMOAgent]                  â”‚
â”‚ 3. æ‰“åˆ†:                                                    â”‚
â”‚    - PMOAgent: 0.92 (é¡¹ç›®è§„åˆ’ä¸“å®¶)                            â”‚
â”‚    - SlideAgent: 0.78 (å¹»ç¯ç‰‡ç›¸å…³)                            â”‚
â”‚    - ScriptAgent: 0.72 (è„šæœ¬ç›¸å…³)                            â”‚
â”‚ 4. æƒé™: å…¨éƒ¨ Allow                                          â”‚
â”‚ 5. æ‰§è¡Œ: å¹¶è¡Œæ‰§è¡Œ 3 ä¸ª Agent                                  â”‚
â”‚ 6. åˆå¹¶: consensus (è¡ŒåŠ¨é¡¹)                                    â”‚
â”‚ 7. ç»“æœ: ä»»åŠ¡åˆ—è¡¨ + æ—¶é—´çº¿                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ·ï¸ æ ‡ç­¾

`#Agentè°ƒåº¦` `#å¬å›æ’åº` `#åˆå¹¶ç­–ç•¥` `#æˆæœ¬æ§åˆ¶` `#ç®—æ³•è®¾è®¡`
